<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>å¤œã®ã‚ã‹ã‚Šï½œé™ã‹ãªã‚ªãƒ³ãƒ©ã‚¤ãƒ³å±…å ´æ‰€</title>
<meta name="description" content="èª°ã‹ãŒã€ŒãŠã‚‹ã€ã ã‘ã§ç¯ã‚‹ã€ä¼šè©±ã®ãªã„ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å±…å ´æ‰€ã€‚é™ã‹ãªæ™‚é–“ã‚’å…±æœ‰ã—ã¾ã™ã€‚">

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app-check.js"></script>

<style>
body {
  background-color: #0b0e1a;
  color: #ffd27d;
  font-size: 28px;
  margin: 0;
  padding: 20px;
  height: 100vh;
  overflow: hidden;
}

#dots {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 80px; /* ãƒœã‚¿ãƒ³åˆ† */
}

button {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 1.2em;
  padding: 0.6em 1.2em;
  z-index: 10;
}

/* è‹ç‡­ */
.candle {
  position: absolute;
  width: 3vw;
  height: 6vw;
  max-width: 16px;
  max-height: 32px;
  border-radius: 50% 50% 60% 60%;
  background: radial-gradient(circle at 50% 20%, #fff, #ff9b5a);
  animation-name: flicker, breathe;
  animation-iteration-count: infinite;
}

@keyframes flicker {
  0%   { transform: scale(1) translateY(0); opacity: 0.9; }
  50%  { transform: scale(0.9) translateY(1px); opacity: 0.7; }
  100% { transform: scale(1) translateY(0); opacity: 0.9; }
}

@keyframes breathe {
  0%   { box-shadow: 0 0 6px rgba(255,180,80,0.6); }
  50%  { box-shadow: 0 0 14px rgba(255,180,80,0.9); }
  100% { box-shadow: 0 0 6px rgba(255,180,80,0.6); }
}
</style>
</head>

<body>

<div id="dots"></div>
<button onclick="imHere()">ãŠã‚‹</button>

<script>
/* ===== Firebase ===== */
firebase.initializeApp({
  apiKey: "AIzaSyCGl6i7ca_9tBrLTjR9bjqJSxkcKOFNoDo",
  authDomain: "yoru-no-akari.firebaseapp.com",
  databaseURL: "https://yoru-no-akari-default-rtdb.firebaseio.com",
  projectId: "yoru-no-akari",
  storageBucket: "yoru-no-akari.firebasestorage.app",
  messagingSenderId: "365296381564",
  appId: "1:365296381564:web:f23e3c3db11682f805e3f9"
});

/* ===== App Check ===== */
firebase.appCheck().activate(
  "6LeFA0osAAAAABNtnCJcE2KUoWzRtnHkr9J5WT1W",
  false
);

var db = firebase.database();
var appCheckReady = false;
firebase.appCheck().onTokenChanged(() => appCheckReady = true);

/* ===== è‡ªåˆ†ã®ç¯ã‚Š ===== */
var myRef = null;

/* ===== ãŠã‚‹ ===== */
function imHere() {
  if (!appCheckReady) return;

  if (!myRef) {
    myRef = db.ref("presence/users").push();
    myRef.onDisconnect().remove();
  }

  myRef.set({
    x: Math.random(),
    y: Math.random(),
    lastActive: Date.now()
  });
}

/* ===== è¡¨ç¤º ===== */
db.ref("presence/users").on("value", function(snapshot){
  var box = document.getElementById("dots");
  box.innerHTML = "";

  var boxW = box.clientWidth;
  var boxH = window.innerHeight - 100; // â† å›ºå®šã§å¼•ã
  var now = Date.now();

  snapshot.forEach(function(child){
    var data = child.val();
    if (!data) return;

    if (now - data.lastActive > 300000) return; // ğŸ‘»æˆä»

    var d = document.createElement("div");
    d.className = "candle";

    var safeY = data.y * 0.9;
    d.style.left = (data.x * boxW) + "px";
    d.style.top  = (safeY * boxH) + "px";

    d.style.animationDuration =
      (1.5 + Math.random()) + "s, " +
      (3 + Math.random() * 2) + "s";

    box.appendChild(d);
  });
});
</script>

</body>
</html>
