<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>夜のあかり</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  background-color: #0b0e1a;
  color: #ffd27d;
  font-size: 28px;
  padding: 20px;
  height: 100vh;
  overflow: hidden;
}

button {
  font-size: 1.2em;
  padding: 0.6em 1.2em;
}

#dots {
  position: relative;
  width: 100%;
  height: calc(100vh - 120px);
}

/* 蝋燭 */
.candle {
  position: absolute;
  display: inline-block;
  width: 3vw;
  height: 6vw;
  max-width: 14px;
  max-height: 28px;
  margin: 6px;
  border-radius: 50% 50% 60% 60%;
  background: radial-gradient(circle at 50% 20%, #fff, #ff9b5a);
  animation-name: flicker, breathe;
  animation-duration: 2s, 4s;
  animation-iteration-count: infinite;
}

@keyframes flicker {
  0%   { transform: scale(1) translateY(0); opacity: 0.9; }
  50%  { transform: scale(0.9) translateY(1px); opacity: 0.7; }
  100% { transform: scale(1) translateY(0); opacity: 0.9; }
}

@keyframes breathe {
  0%   { box-shadow: 0 0 6px rgba(255,180,80,0.6); }
  50%  { box-shadow: 0 0 14px rgba(255,180,80,0.9); }
  100% { box-shadow: 0 0 6px rgba(255,180,80,0.6); }
}

</style>

</head>

<body>

<div id="dots"></div>

<script>
/* ===== Firebase設定（必ず自分のに置き換え） ===== */
var firebaseConfig = {
  apiKey: "AIzaSyCGl6i7ca_9tBrLTjR9bjqJSxkcKOFNoDo",
  authDomain: "yoru-no-akari.firebaseapp.com",
  databaseURL: "https://yoru-no-akari-default-rtdb.firebaseio.com",
  projectId: "yoru-no-akari",
  storageBucket: "yoru-no-akari.firebasestorage.app",
  messagingSenderId: "365296381564",
  appId: "1:365296381564:web:3f990dfb5b29b25405e3f9",
  measurementId: "G-KPNRGKHYJM"
};

/* ===== 初期化 ===== */
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

/* ===== おる ===== */
var myRef = db.ref("presence/users").push();

function imHere() {
  var box = document.getElementById("dots");
  var w = box.clientWidth;
  var h = box.clientHeight;

  var xRate = Math.random(); // 0〜1
  var yRate = Math.random();

myRef.set({
  x: xRate,
  y: yRate
});

  myRef.onDisconnect().remove();
}

/* ===== 人数を見る ===== */
db.ref("presence/users").on("value", function(snapshot){
  var box = document.getElementById("dots");
  box.innerHTML = "";

  snapshot.forEach(function(child){
    var data = child.val();

    var d = document.createElement("div");
    d.className = "candle";

    var boxW = box.clientWidth;
    var boxH = box.clientHeight;

    d.style.left = (data.x * boxW) + "px";
    d.style.top  = (data.y * boxH) + "px";
    d.style.animationDuration =
      (1.5 + Math.random()) + "s, " +
      (3 + Math.random()*2) + "s";

    box.appendChild(d);
  });
});

</script>

<button onclick="imHere()">おる</button>

</body>
</html>
