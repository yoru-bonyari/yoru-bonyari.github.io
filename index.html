<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Â§ú„ÅÆ„ÅÇ„Åã„ÇäÔΩúÈùô„Åã„Å™„Ç™„É≥„É©„Ç§„É≥Â±ÖÂ†¥ÊâÄ</title>

<meta name="description" content="Â§ú„ÅÆ„ÅÇ„Åã„Çä„ÅØ„ÄÅË™∞„Åã„Åå„Äå„Åä„Çã„Äç„Å†„Åë„ÅßÁÅØ„Çã„ÄÅ‰ºöË©±„ÅÆ„Å™„ÅÑ„Ç™„É≥„É©„Ç§„É≥Â±ÖÂ†¥ÊâÄ„Åß„Åô„ÄÇÈùô„Åã„Å™ÊôÇÈñì„ÇíÂÖ±Êúâ„Åó„Åæ„Åô„ÄÇ">

<style>
body {
  background-color: #0b0e1a;
  color: #ffd27d;
  font-size: 28px;
  padding: 20px;
  height: 100vh;
  overflow: hidden;
}
button { font-size: 1.2em; padding: 0.6em 1.2em; }
#dots { position: relative; width: 100%; height: calc(100vh - 120px); }
.candle {
  position: absolute;
  width: 3vw; height: 6vw;
  max-width: 14px; max-height: 28px;
  border-radius: 50% 50% 60% 60%;
  background: radial-gradient(circle at 50% 20%, #fff, #ff9b5a);
  animation-name: flicker, breathe;
  animation-duration: 2s, 4s;
  animation-iteration-count: infinite;
}
@keyframes flicker { 0% {transform:scale(1) translateY(0);opacity:0.9;} 50% {transform:scale(0.9) translateY(1px);opacity:0.7;} 100% {transform:scale(1) translateY(0);opacity:0.9;} }
@keyframes breathe { 0% {box-shadow:0 0 6px rgba(255,180,80,0.6);} 50% {box-shadow:0 0 14px rgba(255,180,80,0.9);} 100% {box-shadow:0 0 6px rgba(255,180,80,0.6);} }
</style>

<!-- Firebase v9 „É¢„Ç∏„É•„Éº„É´ -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { initializeAppCheck, ReCaptchaV3Provider } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app-check.js";

// üîπ Firebase Ë®≠ÂÆö
const firebaseConfig = {
  apiKey: "AIzaSyCGl6i7ca_9tBrLTjR9bjqJSxkcKOFNoDo",
  authDomain: "yoru-no-akari.firebaseapp.com",
  databaseURL: "https://yoru-no-akari-default-rtdb.firebaseio.com",
  projectId: "yoru-no-akari",
  storageBucket: "yoru-no-akari.firebasestorage.app",
  messagingSenderId: "365296381564",
  appId: "1:365296381564:web:3f990dfb5b29b25405e3f9"
};

// üîπ Firebase ÂàùÊúüÂåñ
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// üîπ App Check ÂàùÊúüÂåñÔºàGitHub Pages „Éâ„É°„Ç§„É≥Áî®„Çµ„Ç§„Éà„Ç≠„ÉºÔºâ
initializeAppCheck(app, {
  provider: new ReCaptchaV3Provider('6LeFA0osAAAAABNtnCJcE2KUoWzRtnHkr9J5WT1W'),
  isTokenAutoRefreshEnabled: true
});

// üîπ „Åä„ÇãÁî®
const myRef = push(ref(db, "presence/users"));
window.imHere = () => {
  const box = document.getElementById("dots");
  const x = Math.random();
  const y = Math.random();
  set(myRef, { x, y });
  onDisconnect(myRef).remove();
};

// üîπ ‰∫∫Êï∞„ÇíË¶ã„Çã
const dotsBox = document.getElementById("dots");
onValue(ref(db, "presence/users"), snapshot => {
  dotsBox.innerHTML = "";
  snapshot.forEach(child => {
    const data = child.val();
    const d = document.createElement("div");
    d.className = "candle";
    const w = dotsBox.clientWidth;
    const h = dotsBox.clientHeight;
    d.style.left = (data.x * w) + "px";
    d.style.top = (data.y * h) + "px";
    d.style.animationDuration = (1.5 + Math.random()) + "s, " + (3 + Math.random()*2) + "s";
    dotsBox.appendChild(d);
  });
});
</script>

</head>
<body>
<div id="dots"></div>
<button onclick="imHere()">„Åä„Çã</button>
</body>
</html>
