<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>夜のあかり</title>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  background:#0b0e1a;
  color:#ffd27d;
  font-size:24px;
  padding:40px;
}

button {
  font-size:20px;
  padding:10px 20px;
  margin-bottom:20px;
}

.candle {
  display:inline-block;
  width:10px;
  height:20px;
  margin:6px;
  border-radius:50% 50% 60% 60%;
  background:radial-gradient(circle at 50% 20%, #fff, #ff9b5a);
  animation:flicker 2s infinite;
}

@keyframes flicker {
  0% { opacity:0.8; transform:translateY(0); }
  50% { opacity:0.5; transform:translateY(1px); }
  100% { opacity:0.8; transform:translateY(0); }
}
</style>
</head>

<body>

<h2>今、ここに灯っとる気配</h2>

<div id="dots"></div>

<script>
/* ===== Firebase設定（必ず自分のに置き換え） ===== */
var firebaseConfig = {
  apiKey: "AIzaSyCGl6i7ca_9tBrLTjR9bjqJSxkcKOFNoDo",
  authDomain: "yoru-no-akari.firebaseapp.com",
  databaseURL: "https://yoru-no-akari-default-rtdb.firebaseio.com",
  projectId: "yoru-no-akari",
  storageBucket: "yoru-no-akari.firebasestorage.app",
  messagingSenderId: "365296381564",
  appId: "1:365296381564:web:3f990dfb5b29b25405e3f9",
  measurementId: "G-KPNRGKHYJM"
};

/* ===== 初期化 ===== */
firebase.initializeApp(firebaseConfig);
var db = firebase.database();

/* ===== おる ===== */
  function imHere() {
  alert("おる押されたで");
}



/* ===== 去る ===== */
window.addEventListener("beforeunload", function(){
  if (sessionStorage.getItem("imHere")) {
    db.ref("presence/count").transaction(function(n){
      return Math.max((n || 1) - 1, 0);
    });
  }
});

/* ===== 人数を見る ===== */
db.ref("presence/count").on("value", function(snapshot){
  var num = snapshot.val() || 0;
  var box = document.getElementById("dots");
  box.innerHTML = "";
  for (var i=0; i<num; i++) {
    var d = document.createElement("div");
    d.className = "candle";
    box.appendChild(d);
  }
});
  
</script>

<button onclick="imHere()">おる</button>

</body>
</html>
